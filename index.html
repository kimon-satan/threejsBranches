<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Blob</title>
		<style>
			body { margin: 0; background-color: black }
			canvas { width: 100%; height: 100% }
		</style>


		<script id="vertexShader" type="x-shader/x-vertex">

			uniform vec2 resolution;
			uniform float scale;
			uniform float col_freq;

			attribute vec2 miter;
			attribute float miter_dims;

			attribute float loc_line_prog; //in relation to the currently rendered line
			attribute float glob_line_prog; //in relation to the whole line

			uniform float thickness;

			varying float o_glob_line_prog;
			varying float m_prog;
			varying float inv_loc_prog;
			varying float col_mix;

			float TWO_PI = 6.283185307179586;

			void main()
			{
				vec2 p = position.xy * vec2(resolution.y/resolution.x, 1.0) * scale;
				float a = max(0.01,abs(thickness/miter_dims)); //NB. this number probably needs adjusting in respect of resolution
			    p += miter  *  a * sign(miter_dims);

			    gl_Position = vec4(p.xy, 0.0, 1.0);
			    m_prog = sign(miter_dims);

			    inv_loc_prog = 1.0 - loc_line_prog;
			    o_glob_line_prog = glob_line_prog;

			    col_mix = 0.5 + sin(pow(1.0 - o_glob_line_prog,0.5) * TWO_PI * col_freq) * 0.5;
			    gl_PointSize = 3.0;
			}

		</script>

		<script id="fragmentShader" type="x-shader/x-fragment">

			#ifdef GL_ES
				precision highp float;
			#endif

			uniform vec3 color1;
			uniform vec3 color2;
			uniform float col_freq;


			varying float o_glob_line_prog;
			varying float m_prog;
			varying float inv_loc_prog;
			varying float col_mix;

			float PI  = 3.141592653589793;
			float TWO_PI = 6.283185307179586;

			///////////////////////////////////HELPERS///////////////////////////////////


			void main()	{

				float d = pow(m_prog, 2.5);
				vec3 m = mix(color1, color2, col_mix);
				float alpha = (1.0 - pow(d,inv_loc_prog)) * smoothstep(0.01,0.05, o_glob_line_prog);
				gl_FragColor = vec4(m * alpha,alpha);
				//gl_FragColor = vec4(m ,1.0);
			}

		</script>

	</head>
	<body>
		<script type="text/javascript" src="perlin.js"></script>
		<script type="text/javascript" src="dat.gui.min.js"></script>
		<script src="three.min.js"></script>
		<script type="text/javascript" src="main.js"></script>
	</body>
</html>
